<app-default-login-layout>
  <form
    [formGroup]="signupForm"
    (ngSubmit)="submit()"
    class="auth-form"
    novalidate
  >
    <!-- Full Name -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Full name</mat-label>
      <input
        matInput
        formControlName="name"
        placeholder="Enter your full name"
        autocomplete="name"
      />
      <mat-icon matPrefix class="input-icon">person</mat-icon>
      <mat-error *ngIf="name?.hasError('required')">
        Name is required
      </mat-error>
      <mat-error *ngIf="name?.hasError('minlength')">
        At least 2 characters
      </mat-error>
    </mat-form-field>

    <!-- Username -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Username</mat-label>
      <input
        matInput
        formControlName="username"
        placeholder="Choose a username"
        autocomplete="username"
      />
      <mat-icon matPrefix class="input-icon">account_circle</mat-icon>
      <mat-error *ngIf="username?.hasError('required')">
        Username is required
      </mat-error>
      <mat-error *ngIf="username?.hasError('minlength')">
        At least 3 characters
      </mat-error>
      <mat-error *ngIf="username?.hasError('taken')">
        This username is already in use
      </mat-error>
    </mat-form-field>

    <!-- Email -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Email</mat-label>
      <input
        matInput
        formControlName="email"
        placeholder="you@example.com"
        autocomplete="email"
      />
      <mat-icon matPrefix class="input-icon">email</mat-icon>
      <mat-error *ngIf="email?.hasError('required')">Email is required</mat-error>
      <mat-error *ngIf="email?.hasError('email')">Enter a valid email address</mat-error>
      <mat-error *ngIf="email?.hasError('taken')">
        This email is already registered
      </mat-error>
    </mat-form-field>

    <!-- Age -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Age</mat-label>
      <input
        matInput
        type="number"
        formControlName="age"
        min="15"
        max="100"
        placeholder="Your age"
      />
      <mat-icon matPrefix class="input-icon">cake</mat-icon>
      <mat-error *ngIf="age?.hasError('required')">Age is required</mat-error>
      <mat-error *ngIf="age?.hasError('min') || age?.hasError('tooYoung')">
        You must be at least 15 years old
      </mat-error>
    </mat-form-field>

    <!-- Bio -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Bio (optional)</mat-label>
      <textarea
        matInput
        formControlName="bio"
        rows="3"
        placeholder="Tell people about yourself"
      ></textarea>
      <mat-icon matPrefix class="input-icon">info</mat-icon>
    </mat-form-field>

    <!-- Avatar Upload -->
    <div class="media-upload">
      <input
        type="file"
        #avatarInput
        hidden
        (change)="onAvatar($event)"
        accept="image/*"
      />
      <button
        type="button"
        mat-stroked-button
        (click)="avatarInput.click()"
        class="upload-btn"
      >
        <mat-icon>photo_camera</mat-icon>
        Upload avatar (optional)
      </button>
      <span class="file-name" *ngIf="avatarName">{{ avatarName }}</span>
    </div>

    <!-- Password -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Password</mat-label>
      <input
        matInput
        [type]="hidePw ? 'password' : 'text'"
        formControlName="password"
        placeholder="Minimum 6 characters"
        autocomplete="new-password"
      />
      <mat-icon matPrefix class="input-icon">lock</mat-icon>
      <button
        type="button"
        mat-icon-button
        matSuffix
        (click)="hidePw = !hidePw"
        aria-label="Toggle password visibility"
      >
        <mat-icon>{{ hidePw ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      <mat-error *ngIf="password?.hasError('required')">
        Password is required
      </mat-error>
      <mat-error *ngIf="password?.hasError('minlength')">
        At least 6 characters
      </mat-error>
    </mat-form-field>

    <!-- Confirm Password -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        [type]="hidePw2 ? 'password' : 'text'"
        formControlName="passwordConfirm"
        placeholder="Repeat your password"
        autocomplete="new-password"
      />
      <mat-icon matPrefix class="input-icon">lock</mat-icon>
      <button
        type="button"
        mat-icon-button
        matSuffix
        (click)="hidePw2 = !hidePw2"
        aria-label="Toggle password visibility"
      >
        <mat-icon>{{ hidePw2 ? 'visibility_off' : 'visibility' }}</mat-icon>
      </button>
      <mat-error *ngIf="passwordConfirm?.hasError('required')">
        Confirmation is required
      </mat-error>
      <mat-error *ngIf="passwordConfirm?.hasError('minlength')">
        At least 6 characters
      </mat-error>
      <mat-error *ngIf="passwordConfirm?.hasError('mismatch')">
        Passwords do not match
      </mat-error>
    </mat-form-field>

    <!-- Actions -->
    <div class="actions">
      <button
        mat-flat-button
        color="primary"
        type="submit"
        class="signup-btn"
        [disabled]="signupForm.invalid"
      >
        Create account
      </button>
      <div class="login-link">
        Already have an account?
        <a
          class="link-text"
          role="button"
          tabindex="0"
          (click)="navigate()"
        >
          Log in
        </a>
      </div>
    </div>
  </form>
</app-default-login-layout>

<mat-sidenav-container class="sidenav-container">
  <!-- Sidebar -->
  <mat-sidenav #sidenav mode="side" class="sidenav" fixedInViewport *ngIf="loggedIn">
    <div class="sidenav-header">
      <div class="logo-section">
        <mat-icon class="logo-icon">article</mat-icon>
        <span class="logo-text">01Blog</span>
      </div>
    </div>

    <mat-nav-list class="nav-list">
      <a mat-list-item *ngFor="let item of navItems" [routerLink]="item.route" routerLinkActive="active"
        class="nav-item">
        <mat-icon matListItemIcon class="nav-icon">{{ item.icon }}</mat-icon>
        <span matListItemTitle class="nav-label">{{ item.label }}</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Main content -->
  <mat-sidenav-content>
    <mat-toolbar class="top-toolbar">
      <div class="toolbar-left">
        <button *ngIf="loggedIn" mat-icon-button (click)="sidenav.toggle()" class="menu-btn">
          <mat-icon>menu</mat-icon>
        </button>

        <a class="brand" routerLink="/">
          <mat-icon class="brand-icon">article</mat-icon>
          <span class="brand-text">01Blog</span>
        </a>
      </div>

      <div class="toolbar-right" *ngIf="!isAuthPage">
        <!-- Not Logged In -->
        <ng-container *ngIf="!loggedIn">
          <button mat-button routerLink="/auth/login" class="auth-btn login-btn">
            Sign In
          </button>
          <button mat-flat-button color="primary" routerLink="/auth/signup" class="auth-btn signup-btn">
            Get Started
          </button>
        </ng-container>

        <!-- Logged In -->
        <ng-container *ngIf="loggedIn">
          <button mat-flat-button color="primary" routerLink="/post/create" class="create-btn">
            <mat-icon>edit</mat-icon>
            <span class="btn-text">Write</span>
          </button>

          <button mat-icon-button [matMenuTriggerFor]="notifMenu" class="notif-btn">
            <mat-icon>notifications_none</mat-icon>
            <span *ngIf="hasUnseen" class="notif-badge"></span>
          </button>

          <button mat-icon-button [matMenuTriggerFor]="menu" class="user-btn">
            <img *ngIf="avatarUrl; else defaultIcon" [src]="avatarUrl" class="user-avatar" alt="User Avatar" />
            <ng-template #defaultIcon>
              <mat-icon class="default-avatar">account_circle</mat-icon>
            </ng-template>
          </button>

          <!-- Notifications Menu -->
          <mat-menu #notifMenu="matMenu" class="notification-menu" xPosition="before">
            <div class="menu-header">
              <h3>Notifications</h3>
              <button *ngIf="hasUnseen" mat-button (click)="markAllSeen(); $event.stopPropagation()"
                class="mark-all-btn">
                Mark all read
              </button>
            </div>


            <!-- Tab Buttons -->
            <div class="notification-tabs">
              <button mat-button [ngClass]="{'active-tab': notificationTab === 'unseen'}"
                (click)="showUnseenTab(); $event.stopPropagation()">
                Unseen ({{ unseenNotifications.length }})
              </button>
              <button mat-button [ngClass]="{'active-tab': notificationTab === 'seen'}"
                (click)="showSeenTab(); $event.stopPropagation()">
                Seen ({{ seenNotifications.length }})
              </button>
            </div>



            <div class="menu-content">
              <!-- Unseen Tab -->
              <ng-container *ngIf="notificationTab === 'unseen'">
                <ng-container *ngIf="unseenNotifications.length > 0; else noUnseen">
                  <button mat-menu-item *ngFor="let n of unseenNotifications" class="notification-item unread"
                    (click)="openNotification(n)">
                    <div class="notification-content">
                      <span class="notification-text">{{ formatNotification(n) }}</span>
                      <small class="notif-time">{{ n.createdAt | date:'short' }}</small>
                    </div>
                  </button>
                </ng-container>
                <ng-template #noUnseen>
                  <div class="empty-notifications">
                    <mat-icon>notifications_none</mat-icon>
                    <p>No unseen notifications</p>
                  </div>
                </ng-template>
              </ng-container>

              <!-- Seen Tab -->
              <ng-container *ngIf="notificationTab === 'seen'">
                <ng-container *ngIf="seenNotifications.length > 0; else noSeen">
                  <button mat-menu-item *ngFor="let n of seenNotifications" class="notification-item"
                    (click)="openNotification(n)">
                    <div class="notification-content">
                      <span class="notification-text">{{ formatNotification(n) }}</span>
                      <small class="notif-time">{{ n.createdAt | date:'short' }}</small>
                    </div>
                  </button>
                </ng-container>
                <ng-template #noSeen>
                  <div class="empty-notifications">
                    <mat-icon>notifications_none</mat-icon>
                    <p>No seen notifications</p>
                  </div>
                </ng-template>
              </ng-container>
            </div>
          </mat-menu>


          <!-- User Menu -->
          <mat-menu #menu="matMenu" class="user-menu" xPosition="before">
            <div class="user-menu-header">
              <div class="user-menu-avatar">
                <img *ngIf="avatarUrl" [src]="avatarUrl" alt="Avatar" />
                <mat-icon *ngIf="!avatarUrl">account_circle</mat-icon>
              </div>
              <div class="user-menu-info">
                <span class="user-menu-name">{{ userName || 'Account' }}</span>
              </div>
            </div>

            <mat-divider></mat-divider>

            <button mat-menu-item (click)="goToMyProfile()" class="menu-item">
              <mat-icon>person</mat-icon>
              <span>Profile</span>
            </button>

            <ng-container *ngIf="isAdmin">
              <mat-divider></mat-divider>
              <div class="menu-section-title">Admin</div>
              <button mat-menu-item routerLink="/admin/dashboard" class="menu-item">
                <mat-icon>dashboard</mat-icon>
                <span>Dashboard</span>
              </button>
              <button mat-menu-item routerLink="/admin/users" class="menu-item">
                <mat-icon>group</mat-icon>
                <span>Users</span>
              </button>
              <button mat-menu-item routerLink="/admin/reports" class="menu-item">
                <mat-icon>flag</mat-icon>
                <span>Reports</span>
              </button>
            </ng-container>

            <mat-divider></mat-divider>

            <button mat-menu-item (click)="logout()" class="menu-item logout-item">
              <mat-icon>logout</mat-icon>
              <span>Sign Out</span>
            </button>
          </mat-menu>
        </ng-container>
      </div>
    </mat-toolbar>

    <!-- Page content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
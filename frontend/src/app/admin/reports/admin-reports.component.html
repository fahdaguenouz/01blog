<div class="reports-wrapper">
  <!-- Header -->
  <header class="page-header">
    <div class="header-content">
      <h1 class="page-title">Reports Management</h1>
      <p class="page-subtitle">Review and moderate reported content</p>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <mat-spinner diameter="48" color="primary"></mat-spinner>
    <p>Loading reports...</p>
  </div>

  <!-- Reports Table -->
  <div class="reports-content" *ngIf="!loading">
    <div class="table-card" *ngIf="reports.length">
      <div class="table-header">
        <h3 class="table-title">Active Reports</h3>
        <div class="table-info">
          <span class="count-badge">{{ reports.length }} reports</span>
        </div>
      </div>

      <div class="table-wrapper">
        <table mat-table [dataSource]="reports" class="reports-table">

          <ng-container matColumnDef="reporter">
            <th mat-header-cell *matHeaderCellDef>Reporter</th>
            <td mat-cell *matCellDef="let r">
              <div class="user-cell">
                <img class="user-avatar small" [src]="r.reporterAvatarUrl || 'svg/avatar.png'" alt="Reporter avatar" />
                <span class="username">{{ r.reporterUsername }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="reported">
            <th mat-header-cell *matHeaderCellDef>Reported User</th>
            <td mat-cell *matCellDef="let r">
              <div class="user-cell">
                <img class="user-avatar small reported" [src]="r.reportedAvatarUrl || 'svg/avatar.png'"
                  alt="Reported user avatar" />
                <span class="username">{{ r.reportedUsername }}</span>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef>Category</th>
            <td mat-cell *matCellDef="let r">
              <span class="category-chip">{{ r.category }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="reason">
            <th mat-header-cell *matHeaderCellDef>Reason</th>
            <td mat-cell *matCellDef="let r">
              <p class="reason-text">{{ r.reason }}</p>
            </td>
          </ng-container>

          <ng-container matColumnDef="target">
            <th mat-header-cell *matHeaderCellDef>Target</th>

            <td mat-cell *matCellDef="let r">
              <div class="target-links">
                <!-- ✅ always allow admin to see profile -->
                <a [routerLink]="['/profile', r.reportedUsername]" class="post-link">
                  <mat-icon>person</mat-icon>
                  View Profile
                </a>

                <!-- only if it's a post report -->
                <a *ngIf="r.reportedPostId" [routerLink]="['/post', r.reportedPostId]" class="post-link">
                  <mat-icon>visibility</mat-icon>
                  View Post
                </a>

                <!-- user report label -->
                <span *ngIf="!r.reportedPostId && !r.reportedCommentId" class="no-post">
                  User report
                </span>
              </div>
            </td>
          </ng-container>


          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>

            <td mat-cell *matCellDef="let r">
              <div class="action-buttons">

                <!-- ✅ always allowed -->
                <button mat-button class="action-btn warn" (click)="banUser(r)">
                  <mat-icon>block</mat-icon>
                  Ban User
                </button>

                <button mat-button class="action-btn danger" (click)="deleteUser(r)">
                  <mat-icon>person_remove</mat-icon>
                  Delete User
                </button>

                <!-- ✅ post-only actions (keep if you still want them for post reports) -->
                <ng-container *ngIf="r.reportedPostId">
                  <button mat-button class="action-btn primary" (click)="deletePost(r)">
                    <mat-icon>delete</mat-icon>
                    Delete Post
                  </button>

                  <button mat-button class="action-btn primary" *ngIf="(r.reportedPostStatus ?? 'active') === 'active'"
                    (click)="hidePost(r)">
                    <mat-icon>visibility_off</mat-icon>
                    Hide Post
                  </button>

                  <button mat-button class="action-btn success" *ngIf="r.reportedPostStatus === 'hidden'"
                    (click)="activatePost(r)">
                    <mat-icon>visibility</mat-icon>
                    Activate Post
                  </button>
                </ng-container>

              </div>
            </td>
          </ng-container>


          <tr mat-header-row *matHeaderRowDef="cols"></tr>
          <tr mat-row *matRowDef="let row; columns: cols" class="report-row"></tr>
        </table>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!reports.length">
      <mat-icon class="empty-icon">check_circle</mat-icon>
      <h3>No Active Reports</h3>
      <p>All reports have been resolved. Great work!</p>
    </div>
  </div>
</div>